<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>miso ‚Äì where isochrones meet</title>
  <link rel="icon" type="image/svg+xml" href="miso_logo.svg" />
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@5.18.0/dist/maplibre-gl.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="panel" id="main-panel">
    <div class="panel-header">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <h3 style="display: flex; align-items: center; gap: 10px; margin: 0;">
          <img src="miso_logo.svg" alt="Logo" style="width: 32px; height: 32px;" />
          miso - <br>where isochrones meet
        </h3>
        <button class="btn-close" id="collapse-panel" title="Ein-/Ausklappen">
          <svg width="16" height="16" viewBox="-20 -20 490 450" fill="currentColor">
            <g transform="translate(32, 42.666667) rotate(180 225 200)">
              <path d="M246.312928,5.62892705 C252.927596,9.40873724 258.409564,14.8907053 262.189374,21.5053731 L444.667042,340.84129 C456.358134,361.300701 449.250007,387.363834 428.790595,399.054926 C422.34376,402.738832 415.04715,404.676552 407.622001,404.676552 L42.6666667,404.676552 C19.1025173,404.676552 7.10542736e-15,385.574034 7.10542736e-15,362.009885 C7.10542736e-15,354.584736 1.93772021,347.288125 5.62162594,340.84129 L188.099293,21.5053731 C199.790385,1.04596203 225.853517,-6.06216498 246.312928,5.62892705 Z"/>
            </g>
          </svg>
        </button>
      </div>
      <div id="no-target-hint" class="panel-hint panel-hint--no-target" role="status" aria-live="polite">
        <p class="panel-hint-main">
          <strong>Startpunkt f√ºr Isochrone setzen</strong> Klick in die Karte ‚Üí Es wird eine Erreichbarkeits-Isochrone f√ºr das gew√§hlte Profil berechnet.
        </p>
        <p class="panel-hint-secondary">
          Im Rechtsklick-Men√º: Caf√©s, Restaurants oder Bars/Kneipen suchen.
        </p>
      </div>
    </div>
    <div class="panel-section">
      <section class="config-block" aria-labelledby="block-einstellungen-heading">
        <h4 id="block-einstellungen-heading" class="config-block-title">Einstellungen</h4>
        <div class="config-group">
          <label>Profil:</label>
          <div class="profile-buttons">
          <button id="profile-foot" class="profile-btn active" data-profile="foot" title="Fu√üg√§nger">
            <svg width="20" height="20" viewBox="0 0 59.351 59.351" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M16.113,51.517c-0.918,1.566-0.868,3.498,0.705,4.66c1.346,0.992,3.742,0.863,4.662-0.704
                c1.902-3.244,5.351-5.687,5.351-5.687s-1.27-2.798-1.871-8.041C24.959,41.746,18.277,47.824,16.113,51.517z"/>
              <path d="M43.244,23.299c-3.903-3.474-8.09-6.591-12.672-9.098c-0.493-0.373-1.057-0.665-1.652-0.86
                c-0.398-0.161-0.789-0.239-1.165-0.25c-0.629-0.072-1.259-0.04-1.836,0.115c-1.523,0.408-2.551,1.34-3.136,2.526
                c-2.823,3.297-5.181,6.88-7.297,10.666c-2.101,3.756,3.657,7.117,5.756,3.364c0.656-1.175,1.332-2.333,2.038-3.469
                c0.609,4.104,1.217,8.208,1.824,12.311c0.123,0.832,0.519,1.548,1.072,2.13c0.884,5.842,2.507,11.605,5.066,16.907
                c1.867,3.87,7.614,0.487,5.756-3.365c-1.912-3.961-3.19-8.346-3.977-12.769c1.73-1.205,2.357-3.375,2.033-5.569
                c-0.602-4.052-1.201-8.106-1.803-12.159c1.822,1.315,3.58,2.725,5.275,4.234C41.733,30.858,46.464,26.161,43.244,23.299z"/>
              <circle cx="27.254" cy="5.808" r="5.808"/>
            </svg>
          </button>
          <button id="profile-bike" class="profile-btn" data-profile="bike" title="Fahrrad">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="5.5" cy="17.5" r="3.5"></circle>
              <circle cx="18.5" cy="17.5" r="3.5"></circle>
              <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
              <path d="M12 17.5V14l-3-3 4-3 2 3h3"></path>
            </svg>
          </button>
          <button id="profile-car" class="profile-btn" data-profile="car" title="Auto">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.78 9.44L17.94 4.44C17.8238 4.09604 17.6036 3.79671 17.3097 3.5835C17.0159 3.37029 16.663 3.25374 16.3 3.25H7.7C7.3418 3.2508 6.99248 3.36151 6.6992 3.56716C6.40592 3.77281 6.18281 4.06351 6.06 4.4L4.22 9.4C3.92473 9.54131 3.67473 9.76216 3.49808 10.0377C3.32142 10.3133 3.22512 10.6327 3.22 10.96V15.46C3.21426 15.7525 3.28279 16.0417 3.41921 16.3006C3.55562 16.5594 3.75544 16.7794 4 16.94V17V19C4 19.2652 4.10536 19.5196 4.29289 19.7071C4.48043 19.8946 4.73478 20 5 20H6C6.26522 20 6.51957 19.8946 6.70711 19.7071C6.89464 19.5196 7 19.2652 7 19V17.25H17V19C17 19.2652 17.1054 19.5196 17.2929 19.7071C17.4804 19.8946 17.7348 20 18 20H19C19.2652 20 19.5196 19.8946 19.7071 19.7071C19.8946 19.5196 20 19.2652 20 19V17C20 17 20 17 20 16.94C20.2351 16.7808 20.4275 16.5661 20.56 16.315C20.6925 16.0639 20.7612 15.784 20.76 15.5V11C20.7567 10.6748 20.6634 10.3569 20.4904 10.0815C20.3174 9.80616 20.0715 9.58411 19.78 9.44ZM19.25 15.5C19.25 15.5663 19.2237 15.6299 19.1768 15.6768C19.1299 15.7237 19.0663 15.75 19 15.75H5C4.93369 15.75 4.87011 15.7237 4.82322 15.6768C4.77634 15.6299 4.75 15.5663 4.75 15.5V11C4.75 10.9337 4.77634 10.8701 4.82322 10.8232C4.87011 10.7763 4.93369 10.75 5 10.75H19C19.0663 10.75 19.1299 10.7763 19.1768 10.8232C19.2237 10.8701 19.25 10.9337 19.25 11V15.5ZM7.47 4.91C7.48797 4.86341 7.51949 4.82327 7.56048 4.79475C7.60147 4.76624 7.65007 4.75065 7.7 4.75H16.3C16.3499 4.75065 16.3985 4.76624 16.4395 4.79475C16.4805 4.82327 16.512 4.86341 16.53 4.91L17.93 8.75H6.07L7.47 4.91Z"></path>
              <path d="M8 14.75C8.82843 14.75 9.5 14.0784 9.5 13.25C9.5 12.4216 8.82843 11.75 8 11.75C7.17157 11.75 6.5 12.4216 6.5 13.25C6.5 14.0784 7.17157 14.75 8 14.75Z"></path>
              <path d="M16 14.75C16.8284 14.75 17.5 14.0784 17.5 13.25C17.5 12.4216 16.8284 11.75 16 11.75C15.1716 11.75 14.5 12.4216 14.5 13.25C14.5 14.0784 15.1716 14.75 16 14.75Z"></path>
            </svg>
          </button>
          <button id="profile-transit" class="profile-btn" data-profile="transit" title="√ñPNV (Transitous)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
              <rect x="5" y="3" width="14" height="14" rx="2" ry="2"></rect>
              <path d="M8 7h8"></path>
              <path d="M8 10h8"></path>
              <path d="M7 17l-1.5 3"></path>
              <path d="M17 17l1.5 3"></path>
              <circle cx="9" cy="14" r="1"></circle>
              <circle cx="15" cy="14" r="1"></circle>
            </svg>
          </button>
        </div>
        </div>

        <!-- Transit-Info-Panel (nur bei Transit-Profil sichtbar) -->
        <div id="transit-info-panel" class="config-group" style="display: none; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid #3388ff;">
          <div style="font-size: 11px; color: #666; margin-bottom: 8px;">
            <strong style="color: #333;">üöÜ Transit-Parameter</strong>
          </div>
          <div style="font-size: 11px; color: #555; line-height: 1.6;">
            <div style="margin-bottom: 6px;">
              <label for="transit-departure-time" style="display: block; margin-bottom: 3px;"><strong>Abfahrtszeit:</strong></label>
              <div style="display: flex; gap: 6px; align-items: center;">
                <input type="text" id="transit-departure-time" placeholder="Datum und Uhrzeit w√§hlen..." style="flex: 1; padding: 6px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; background: white;" readonly />
                <button type="button" id="transit-time-now-btn" title="Auf aktuelle Zeit setzen" style="padding: 6px 10px; font-size: 11px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; white-space: nowrap;">Jetzt</button>
              </div>
            </div>
            <div style="margin-bottom: 4px;">
              <strong>Max. Umstiege:</strong> <span id="transit-max-transfers">14</span>
            </div>
            <div style="margin-bottom: 4px;">
              <strong>Vor-/Nachweg:</strong> <span id="transit-walk-time">je 15 Min. zu Fu√ü</span>
            </div>
          </div>
          <p class="config-hint" style="font-size: 10px; color: #888; margin-top: 6px; margin-bottom: 0;">
            Powered by <a href="https://transitous.org" target="_blank" rel="noopener" style="color: #3388ff;">Transitous</a> / <a href="https://motis-project.de" target="_blank" rel="noopener" style="color: #3388ff;">MOTIS</a>
          </p>
        </div>

        <!-- Zeitlimit und Bucket-Gr√∂√üe (kompakt) -->
        <div class="config-group-inline" id="isochrone-params-group" style="margin-bottom: 16px;">
          <div class="config-field-half">
            <label for="config-isochrone-time">Zeitlimit:</label>
            <input type="number" id="config-isochrone-time" min="5" max="120" step="5" value="10" />
          </div>
          <div class="config-field-half">
            <label for="config-isochrone-bucket-size">Bucket-Gr√∂√üe:</label>
            <select id="config-isochrone-bucket-size">
              <option value="5" selected>5 min</option>
              <option value="10">10 min</option>
              <option value="20">20 min</option>
            </select>
          </div>
        </div>

        <div class="config-group button-row-with-actions">
          <button type="button" id="btn-calculate-isochrone" class="btn-calculate-isochrone">Isochronen berechnen</button>
          <button type="button" id="export-btn" class="icon-action-btn" title="Isochrone als GeoJSON exportieren" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
        </div>

        <div class="config-group">
          <div class="switch-toggle">
            <label for="config-remember-isochrone-starts">
              <input type="checkbox" id="config-remember-isochrone-starts" />
              <span class="switch-slider"></span>
              <span class="switch-text">Startpunkte merken</span>
            </label>
          </div>
        </div>
        <div class="config-group" id="saved-isochrones-list-group" style="display: none;">
          <label>Gespeicherte Startpunkte:</label>
          <div id="saved-isochrones-list" class="targets-list"></div>
          <button type="button" id="saved-isochrones-clear-all" class="export-button" style="margin-top: 6px;">Alle l√∂schen</button>
        </div>

        <!-- Hex-Raster-Vereinfachung -->
        <div class="config-group hex-snap-group">
          <div class="hex-snap-header">
            <span class="hex-snap-title">Hex-Raster</span>
            <span class="info-hint">
              <span class="info-hint-icon">‚ìò</span>
              <span class="info-hint-text">
                Hilft v. a. bei St√§dten: weniger Polygon-Punkte ‚Üí Turf-Operationen schneller. Kleinere Hexe = mehr Detail, aber langsamer. Wenn es zu viele Zellen werden, wird automatisch grober gerastert.
              </span>
            </span>
          </div>
          <div class="hex-snap-controls">
            <div class="switch-toggle switch-toggle-small">
              <label for="config-isochrone-hex-snap">
                <input type="checkbox" id="config-isochrone-hex-snap" />
                <span class="switch-slider"></span>
                <span class="switch-text">Vereinfachen</span>
              </label>
            </div>
            <div class="hex-size-control">
              <select id="config-isochrone-hex-size">
                <option value="100" selected>Sehr fein (100 m)</option>
                <option value="250">Fein (250 m)</option>
                <option value="500">Mittel (500 m)</option>
                <option value="1000">Grob (1000 m)</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <section class="config-block" aria-labelledby="block-optimierung-heading">
        <h4 id="block-optimierung-heading" class="config-block-title">Optimierung</h4>
        <div class="config-group" id="optimization-overlap-group" style="display: none;">
          <label for="config-optimization-mode" class="config-label">Modus</label>
          <select id="config-optimization-mode" class="config-select" aria-describedby="optimization-hint">
            <option value="none">Keine</option>
            <option value="overlap">Von allen in gleicher Zeit erreichbar</option>
            <option value="system_optimal">Systemoptimal (Einzugsgebiete)</option>
          </select>
          <p id="optimization-hint" class="config-hint" style="font-size: 11px; color: #666; margin-top: 4px;">
            <strong>√úberlappung:</strong> Fl√§chen, die von allen Startpunkten in derselben Zeit erreichbar sind.
            <strong>Systemoptimal:</strong> Jeder Ort wird dem n√§chsten Start zugeordnet ‚Äì geringste Gesamt-Reisezeit.
          </p>

          <div id="optimization-advanced-controls" style="display:none; margin-top: 10px;">
            <div class="switch-toggle switch-toggle-small" style="margin-bottom: 8px;">
              <label for="config-opt-link-budgets">
                <input type="checkbox" id="config-opt-link-budgets" />
                <span class="switch-slider"></span>
                <span class="switch-text">Zeitbudget f√ºr alle koppeln</span>
              </label>
            </div>

            <label for="config-opt-global-budget">Zeitbudget (max)</label>
            <input type="range" id="config-opt-global-budget" min="0" max="0" step="1" />
            <div id="config-opt-global-budget-label" class="config-hint" style="font-size: 11px; color: #666; margin-top: 4px;"></div>

            <div id="optimization-starts-container" style="margin-top: 10px;"></div>

            <div class="optimization-buttons" style="margin-top: 10px;">
              <button type="button" id="optimization-add-buckets" class="export-button">Mehr Buckets (+1)</button>
              <button type="button" id="optimization-reset-budgets" class="export-button">Reset</button>
            </div>
            <div id="optimization-status" class="config-hint" style="font-size: 11px; color: #666; margin-top: 6px;"></div>
          </div>
        </div>
      </section>

      <div class="api-credits" style="font-size: 11px; color: #888; text-align: center; line-height: 1.6; padding-top: 15px; border-top: 1px solid #eee;">
        Routing: <a href="https://www.graphhopper.com/open-source/" target="_blank" rel="noopener" style="color: #888; text-decoration: none;">GraphHopper</a> ‚Ä¢ 
        <a href="https://transitous.org" target="_blank" rel="noopener" style="color: #888; text-decoration: none;">Transitous</a> / 
        <a href="https://motis-project.de" target="_blank" rel="noopener" style="color: #888; text-decoration: none;">MOTIS</a>
      </div>
      
      <div class="github-links">
        <img src="https://img.shields.io/badge/Status-Experimental-red" alt="Status: Experimental" class="status-badge">
        <div style="flex: 1;"></div>
        <a href="https://github.com/vizsim/miso" target="_blank" rel="noopener noreferrer" 
           title="GitHub Repository" 
           class="github-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
        </a>
        <a href="https://github.com/vizsim/miso/issues" target="_blank" rel="noopener noreferrer" 
           title="Fehler melden oder Feedback geben"
           class="github-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/>
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"/>
          </svg>
          <span>Issues</span>
        </a>
      </div>
    </div>
  </div>
  <div id="map-wrapper" class="map-wrapper">
    <div id="map"></div>
  </div>

  <!-- Bottom Left UI Container (Layer / Karten-Einstellungen + Einwohner-Legende) -->
  <div id="bottom-left-ui-container">
    <div id="custom-nav-control-wrapper">
      <div id="custom-nav-control"></div>
    </div>
    <div id="map-settings-menu">
      <button id="map-settings-toggle" class="map-settings-btn" title="Karten-Einstellungen">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" fill-rule="nonzero">
          <path d="M20.0256266,12.1919251 C19.8772338,12.4293536 19.6806426,12.6329794 19.4485757,12.7896246 L13.3986821,16.8733027 C12.5534904,17.4438072 11.4465096,17.4438072 10.6013179,16.8733027 L4.55142428,12.7896246 C3.79043588,12.2759574 3.49533538,11.3303569 3.77229147,10.5 L10.6132495,15.0595795 C11.4005138,15.5844224 12.4112447,15.617225 13.2264422,15.1579876 L13.3867505,15.0595795 L20.2270621,10.4994959 C20.4087649,11.0456562 20.3545192,11.665697 20.0256266,12.1919251 Z M20.2270621,13.7494959 C20.4087649,14.2956562 20.3545192,14.915697 20.0256266,15.4419251 C19.8772338,15.6793536 19.6806426,15.8829794 19.4485757,16.0396246 L13.3986821,20.1233027 C12.5534904,20.6938072 11.4465096,20.6938072 10.6013179,20.1233027 L4.55142428,16.0396246 C3.79043588,15.5259574 3.49533538,14.5803569 3.77229147,13.75 L10.6132495,18.3095795 C11.4005138,18.8344224 12.4112447,18.867225 13.2264422,18.4079876 L13.3867505,18.3095795 L20.2270621,13.7494959 Z M13.3867505,3.42450033 L19.7519246,7.66794971 C20.2114532,7.97430216 20.3356271,8.59517151 20.0292747,9.0547002 C19.9560398,9.16455248 19.8617768,9.25881544 19.7519246,9.33205029 L13.3867505,13.5754997 C12.547002,14.135332 11.452998,14.135332 10.6132495,13.5754997 L4.24807544,9.33205029 C3.78854675,9.02569784 3.66437288,8.40482849 3.97072534,7.9452998 C4.0439602,7.83544752 4.13822315,7.74118456 4.24807544,7.66794971 L10.6132495,3.42450033 C11.452998,2.86466797 12.547002,2.86466797 13.3867505,3.42450033 Z M11.560754,4.60622527 L11.4452998,4.67257577 L5.705,8.5 L11.4452998,12.3274242 C11.7438771,12.5264757 12.1228116,12.5485926 12.439246,12.3937747 L12.5547002,12.3274242 L18.294,8.5 L12.5547002,4.67257577 C12.2561229,4.47352427 11.8771884,4.45140743 11.560754,4.60622527 Z"/>
        </svg>
      </button>
      <div id="map-settings-panel" class="map-settings-panel hidden">
        <div class="map-settings-section">
          <div class="map-settings-label">Overlays</div>
          <div class="overlay-tiles">
            <button type="button" class="overlay-tile" id="overlay-opnv" data-overlay="opnv" title="√ñPNV (FacilMap)">
              <span class="overlay-tile-icon">üöå</span>
              <span class="overlay-tile-label">√ñPNV</span>
            </button>
            <button type="button" class="overlay-tile" id="overlay-einwohner" data-overlay="einwohner" title="Einwohner (Zensus 100 m)">
              <span class="overlay-tile-icon">üë•</span>
              <span class="overlay-tile-label">Einwohner</span>
            </button>
          </div>
        </div>
        <div class="map-settings-divider"></div>
        <div class="map-settings-section">
          <div class="map-settings-label">Kartenstil</div>
          <div class="basemap-buttons">
            <button class="basemap-btn selected" data-map="standard" title="Standard (OpenFreeMap Positron)"></button>
            <button class="basemap-btn" data-map="osm" title="OpenStreetMap"></button>
            <button class="basemap-btn" data-map="satellite" title="Satellit"></button>
          </div>
        </div>
        <div class="map-settings-divider"></div>
        <div class="map-settings-section">
          <div class="map-settings-label">Ansicht</div>
          <div class="switch-control">
            <div class="switch-label" title="Mapterhorn Terrain Daten">
              <span>Terrain</span>
              <label class="switch">
                <input type="checkbox" id="toggleTerrain" />
                <span class="switch-slider"></span>
              </label>
            </div>
            <div class="switch-label" title="Mapterhorn Hillshade Daten">
              <span>Hillshade</span>
              <label class="switch">
                <input type="checkbox" id="toggleHillshade" />
                <span class="switch-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="population-legend-wrapper" class="population-legend-wrapper">
      <div id="population-legend" class="population-legend" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Kontextmen√º f√ºr Karte -->
  <div id="context-menu" class="context-menu" style="display: none;">
    <div class="context-menu-item" id="context-menu-set-end">
      <span class="context-menu-icon-wrap">
        <span class="context-menu-dot" title="Isochrone hier berechnen"></span>
      </span>
      <span class="context-menu-label">Isochrone hier berechnen</span>
    </div>
    <div class="context-menu-separator"></div>
    <a class="context-menu-item" id="context-menu-osm-query" target="_blank" rel="noopener noreferrer" href="#">
      <span class="context-menu-icon-wrap">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
      </span>
      <span class="context-menu-label">OSM Objektabfrage</span>
    </a>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" id="context-menu-cafes">
      <span class="context-menu-icon-wrap context-menu-emoji">‚òï</span>
      <span class="context-menu-label">Caf√©s hier suchen</span>
    </div>
    <div class="context-menu-item" id="context-menu-restaurants">
      <span class="context-menu-icon-wrap context-menu-emoji">üçΩ</span>
      <span class="context-menu-label">Restaurants hier suchen</span>
    </div>
    <div class="context-menu-item" id="context-menu-bars">
      <span class="context-menu-icon-wrap context-menu-emoji">üç∫</span>
      <span class="context-menu-label">Bars/Kneipen hier suchen</span>
    </div>
  </div>

  <!-- Kontextmen√º f√ºr Zielpunkte -->
  <div id="target-context-menu" class="context-menu" style="display: none;">
    <div class="context-menu-item" id="target-context-menu-delete">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
      <span>L√∂schen</span>
    </div>
  </div>

  <!-- Warnung bei vielen Routen -->
  <div id="route-warning-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="modal-icon">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <h3 class="modal-title">Viele Routen erkannt</h3>
      </div>
      <div class="modal-body">
        <p>Es werden aktuell <strong id="route-warning-count">0</strong> Routen dargestellt.</p>
        <p>Bei einer gro√üen Anzahl von Routen kann die Darstellung langsamer werden, denn die Visualisierung wird von Deinem Browser gerechnet.</p>
      </div>
      <div class="modal-footer">
        <button id="route-warning-continue" class="modal-btn modal-btn-primary">Ja, okee</button>
      </div>
    </div>
  </div>

  <!-- Startpunkt bearbeiten (Zeitlimit, Buckets, Profil) -->
  <div id="edit-isochrone-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="edit-isochrone-modal-title">Startpunkt bearbeiten</h3>
      </div>
      <div class="modal-body">
        <div class="config-group modal-geocoder" style="margin-bottom: 10px; position: relative;">
          <label for="edit-isochrone-location">Startpunkt (Adresse):</label>
          <input type="text" id="edit-isochrone-location" placeholder="Adresse suchen‚Ä¶" autocomplete="off" />
          <div id="edit-isochrone-location-suggestions" class="geocoder-suggestions" style="display:none;"></div>
          <p class="config-hint" style="font-size: 11px; color: #666; margin-top: 4px;">
            Tipp: Adresse ausw√§hlen ‚Üí Startpunkt wird dorthin verschoben und Isochrone neu berechnet.
          </p>
        </div>

        <div class="config-group" style="margin-bottom: 10px;">
          <label for="edit-isochrone-bucket-size">Bucket-Gr√∂√üe (Min.):</label>
          <select id="edit-isochrone-bucket-size">
            <option value="5" selected>5 min</option>
            <option value="10">10 min</option>
            <option value="20">20 min</option>
          </select>
        </div>
        <div class="config-group" style="margin-bottom: 10px;">
          <label for="edit-isochrone-time">Zeitlimit (Min.):</label>
          <input type="number" id="edit-isochrone-time" min="5" max="120" step="5" value="10" />
        </div>
        <div class="config-group" style="margin-bottom: 10px;">
          <label>Hauptfarbe:</label>
          <div class="modal-colorpicker">
            <input type="color" id="edit-isochrone-color" value="#3388ff" title="Farbe w√§hlen" />
            <input type="text" id="edit-isochrone-color-hex" value="#3388ff" inputmode="text" autocapitalize="off" spellcheck="false" />
            <div class="modal-color-swatches" id="edit-isochrone-color-swatches">
              <button type="button" class="modal-swatch" data-color="#3388ff" style="background:#3388ff" aria-label="Blau"></button>
              <button type="button" class="modal-swatch" data-color="#22c55e" style="background:#22c55e" aria-label="Gr√ºn"></button>
              <button type="button" class="modal-swatch" data-color="#f59e0b" style="background:#f59e0b" aria-label="Orange"></button>
              <button type="button" class="modal-swatch" data-color="#ef4444" style="background:#ef4444" aria-label="Rot"></button>
              <button type="button" class="modal-swatch" data-color="#a855f7" style="background:#a855f7" aria-label="Violett"></button>
              <button type="button" class="modal-swatch" data-color="#111827" style="background:#111827" aria-label="Schwarz"></button>
            </div>
          </div>
          <p class="config-hint" style="font-size: 11px; color: #666; margin-top: 4px;">
            Hex eingeben oder Picker/Palette nutzen.
          </p>
        </div>
        <div class="config-group">
          <label>Profil:</label>
          <div class="profile-buttons" id="edit-isochrone-profile-btns">
            <button type="button" class="profile-btn edit-profile-btn" data-profile="foot" title="Fu√üg√§nger">
              <svg width="20" height="20" viewBox="0 0 59.351 59.351" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.113,51.517c-0.918,1.566-0.868,3.498,0.705,4.66c1.346,0.992,3.742,0.863,4.662-0.704c1.902-3.244,5.351-5.687,5.351-5.687s-1.27-2.798-1.871-8.041C24.959,41.746,18.277,47.824,16.113,51.517z"/>
                <path d="M43.244,23.299c-3.903-3.474-8.09-6.591-12.672-9.098c-0.493-0.373-1.057-0.665-1.652-0.86c-0.398-0.161-0.789-0.239-1.165-0.25c-0.629-0.072-1.259-0.04-1.836,0.115c-1.523,0.408-2.551,1.34-3.136,2.526c-2.823,3.297-5.181,6.88-7.297,10.666c-2.101,3.756,3.657,7.117,5.756,3.364c0.656-1.175,1.332-2.333,2.038-3.469c0.609,4.104,1.217,8.208,1.824,12.311c0.123,0.832,0.519,1.548,1.072,2.13c0.884,5.842,2.507,11.605,5.066,16.907c1.867,3.87,7.614,0.487,5.756-3.365c-1.912-3.961-3.19-8.346-3.977-12.769c1.73-1.205,2.357-3.375,2.033-5.569c-0.602-4.052-1.201-8.106-1.803-12.159c1.822,1.315,3.58,2.725,5.275,4.234C41.733,30.858,46.464,26.161,43.244,23.299z"/>
                <circle cx="27.254" cy="5.808" r="5.808"/>
              </svg>
            </button>
            <button type="button" class="profile-btn edit-profile-btn" data-profile="bike" title="Fahrrad">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="5.5" cy="17.5" r="3.5"></circle>
                <circle cx="18.5" cy="17.5" r="3.5"></circle>
                <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
                <path d="M12 17.5V14l-3-3 4-3 2 3h3"></path>
              </svg>
            </button>
            <button type="button" class="profile-btn edit-profile-btn" data-profile="car" title="Auto">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.78 9.44L17.94 4.44C17.8238 4.09604 17.6036 3.79671 17.3097 3.5835C17.0159 3.37029 16.663 3.25374 16.3 3.25H7.7C7.3418 3.2508 6.99248 3.36151 6.6992 3.56716C6.40592 3.77281 6.18281 4.06351 6.06 4.4L4.22 9.4C3.92473 9.54131 3.67473 9.76216 3.49808 10.0377C3.32142 10.3133 3.22512 10.6327 3.22 10.96V15.46C3.21426 15.7525 3.28279 16.0417 3.41921 16.3006C3.55562 16.5594 3.75544 16.7794 4 16.94V17V19C4 19.2652 4.10536 19.5196 4.29289 19.7071C4.48043 19.8946 4.73478 20 5 20H6C6.26522 20 6.51957 19.8946 6.70711 19.7071C6.89464 19.5196 7 19.2652 7 19V17.25H17V19C17 19.2652 17.1054 19.5196 17.2929 19.7071C17.4804 19.8946 17.7348 20 18 20H19C19.2652 20 19.5196 19.8946 19.7071 19.7071C19.8946 19.5196 20 19.2652 20 19V17C20 17 20 17 20 16.94C20.2351 16.7808 20.4275 16.5661 20.56 16.315C20.6925 16.0639 20.7612 15.784 20.76 15.5V11C20.7567 10.6748 20.6634 10.3569 20.4904 10.0815C20.3174 9.80616 20.0715 9.58411 19.78 9.44ZM19.25 15.5C19.25 15.5663 19.2237 15.6299 19.1768 15.6768C19.1299 15.7237 19.0663 15.75 19 15.75H5C4.93369 15.75 4.87011 15.7237 4.82322 15.6768C4.77634 15.6299 4.75 15.5663 4.75 15.5V11C4.75 10.9337 4.77634 10.8701 4.82322 10.8232C4.87011 10.7763 4.93369 10.75 5 10.75H19C19.0663 10.75 19.1299 10.7763 19.1768 10.8232C19.2237 10.8701 19.25 10.9337 19.25 11V15.5ZM7.47 4.91C7.48797 4.86341 7.51949 4.82327 7.56048 4.79475C7.60147 4.76624 7.65007 4.75065 7.7 4.75H16.3C16.3499 4.75065 16.3985 4.76624 16.4395 4.79475C16.4805 4.82327 16.512 4.86341 16.53 4.91L17.93 8.75H6.07L7.47 4.91Z"></path>
                <path d="M8 14.75C8.82843 14.75 9.5 14.0784 9.5 13.25C9.5 12.4216 8.82843 11.75 8 11.75C7.17157 11.75 6.5 12.4216 6.5 13.25C6.5 14.0784 7.17157 14.75 8 14.75Z"></path>
                <path d="M16 14.75C16.8284 14.75 17.5 14.0784 17.5 13.25C17.5 12.4216 16.8284 11.75 16 11.75C15.1716 11.75 14.5 12.4216 14.5 13.25C14.5 14.0784 15.1716 14.75 16 14.75Z"></path>
              </svg>
            </button>
            <button type="button" class="profile-btn edit-profile-btn" data-profile="transit" title="√ñPNV (Transitous)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                <rect x="5" y="3" width="14" height="14" rx="2" ry="2"></rect>
                <path d="M8 7h8"></path>
                <path d="M8 10h8"></path>
                <path d="M7 17l-1.5 3"></path>
                <path d="M17 17l1.5 3"></path>
                <circle cx="9" cy="14" r="1"></circle>
                <circle cx="15" cy="14" r="1"></circle>
              </svg>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="edit-isochrone-cancel" class="modal-btn">Abbrechen</button>
        <button type="button" id="edit-isochrone-apply" class="modal-btn modal-btn-primary">√úbernehmen</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@5.18.0/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://unpkg.com/h3-js@4.4.0/dist/h3-js.umd.js"></script>
  <script src="https://unpkg.com/pbf@3.2.1/dist/pbf.js"></script>
  <script src="https://unpkg.com/pmtiles@4.4.0/dist/pmtiles.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/l10n/de.js"></script>
  
  <!-- Core -->
  <script src="src/shared/core/utils.js"></script>
  <script src="src/shared/core/state.js"></script>
  <script src="src/core/config.js"></script>
  <script src="src/shared/core/events.js"></script>
  
  <!-- Domain -->
  <script src="src/shared/domain/geo.js"></script>
  <script src="src/shared/domain/api.js"></script>
  <script src="src/shared/domain/distribution.js"></script>
  
  <!-- Services -->
  <script src="src/services/aggregation-service.js"></script>
  <script src="src/services/target-service.js"></script>
  <script src="src/features/routing/route-service.js"></script>
  <script src="src/features/isochrones/isochrone-service.js"></script>
  <script src="src/features/isochrones/isochrone-params.js"></script>
  <script src="src/features/population/population-service.js"></script>
  <script src="src/services/export-service.js"></script>
  <script src="src/features/pois/overpass-service.js"></script>
  
  <!-- Visualization -->
  <script src="src/visualization/colormap-utils.js"></script>
  <script src="src/visualization/histogram-renderer.js"></script>
  <script src="src/visualization/marker-manager.js"></script>
  <script src="src/features/pois/poi-renderer.js"></script>
  <script src="src/visualization/visualization.js"></script>
  <script src="src/visualization/map-renderer.js"></script>
  <script src="src/features/routing/route-renderer.js"></script>
  <script src="src/features/isochrones/isochrone-renderer.js"></script>
  <script src="src/features/isochrones/overlap-renderer.js"></script>
  
  <!-- Utils -->
  <script src="src/utils/async-helpers.js"></script>
  <script src="src/utils/geocoder.js"></script>
  
  <!-- UI -->
  <script src="src/ui/targets-list.js"></script>
  <script src="src/ui/saved-isochrones-list.js"></script>
  <script src="src/ui/config-helpers.js"></script>
  <script src="src/ui/config-setup-handlers.js"></script>
  <script src="src/ui/distribution-selector.js"></script>
  <script src="src/ui/colormap-selector.js"></script>
  <script src="src/ui/map-layer-controls.js"></script>
  <script src="src/features/routing/route-warning.js"></script>
  
  <!-- Handlers -->
  <script src="src/features/routing/route-handler.js"></script>
  <script src="src/features/isochrones/overlap-controller.js"></script>
  
  <!-- App -->
  <script src="src/app.js"></script>
</body>
</html>

